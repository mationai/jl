// Generated by CoffeeScript 1.3.3
(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v=function(e,t){return function(){return e.apply(t,arguments)}};e=jQuery,t=function(t,n){return n==null&&(n=""),e(document.createElement(t)).addClass(n)},o=function(e,n){return t("span",n).text(e)},n=function(e,n){return t("div",n).text(e)},r=function(){return o("✔","correct eval-mark")},u=function(){return o("✘","wrong eval-mark")},s=function(e){return o(e,"correct")},f=function(e){return o(e,"wrong")},i=function(){return o("Correct!","correct")},a=function(e,t,n){var r;return r="Please try again.",n&&e&&t!=null?o(r,"wrong sorry"):n&&t!=null?o(t,"wrong sorry"):!p(e)&&t!=null&&String(t).indexOf("ReferenceError")===0?o(t.slice(16)+".","wrong sorry"):o(r,"wrong sorry")},p=function(e){return String(e).indexOf("null")===0||String(e).indexOf("SyntaxError")===0||String(e).indexOf("ReferenceError")===0},c=function(e,t){var n,r,i,s,o;for(s=0,o=t.length;s<o;s++){r=t[s];for(n in r){i=r[n];if(n==="contains"){if(e.indexOf(i)===-1)return!1}else if(n==="minLength"&&e.length<i)return!1}}return!0},d=function(e){return e=e.replace(/"\'/g,'"'),e=e.replace(/"\"/g,'"'),e=e.replace(/\'"/g,'"'),e=e.replace(/\""/g,'"'),e},h={show:"easeOutCirc",scrollNext:"easeInOutQuad",scrollTo:"easeOutCubic",speed:1700},l=function(){function t(e,t,n){this.lessons=n,this.showHint=v(this.showHint,this),this.lesson=1,this.exercise=1,this.iExercise=0,this.score=_(this.lessons).map(function(e){return _.map(e.exercises,function(e){return 0})}),this.attempt=_.clone(this.score),this._numExercises=[].concat(_.map(this.score,function(e){return e.length})),this._nextExercise=_.map(this.score,function(e){return 1}),this._editors=[],LiveCode.scan(e,function(e){return this._editors.push(e),e.setOption("extraKeys",{Enter:function(){return e.getOption("onBlur")()}})},this),LiveCode.scan(t,function(e){return this._editors.push(e),e.setOption("extraKeys",{"Ctrl-Enter":function(){return e.getOption("onBlur")()}}),e.setOption("lineNumbers",!0)},this),this._exerciseCnt=this._editors.length,this._scrollY=_.map(this.score,function(e){return 0})}return t.prototype.keepScore=function(e,t,n){return t==null&&(t=this.lesson),n==null&&(n=this.exercise),e&&(this.score[t-1][n-1]=1),this.attempt[t-1][n-1]+=1},t.prototype.getAttempt=function(e,t){return e==null&&(e=this.lesson),t==null&&(t=this.exercise),this.attempt[e-1][t-1]},t.prototype.completedLesson=function(e){return e==null&&(e=this.lesson),_.every(this.score[e-1],_.identity)},t.prototype.setCurrent=function(e,t){return this.lesson=e,this.exercise=t||this.nextExercise(this.lesson),this.iExercise=this.getiExercise(e,this.exercise)},t.prototype.nextExercise=function(e){return this._nextExercise[e-1]},t.prototype.setNextExercise=function(){return this._nextExercise[this.lesson-1]=this.onLastExerciseInLesson()?this.exercise:this.exercise+1},t.prototype.getiExercise=function(e,t){var n;return e==null&&(e=this.lesson),t==null&&(t=this.exercise),n=_.reduce(this._numExercises,function(t,n,r){return r<e-1?n+t:t},0),n+t-1},t.prototype.onLastExerciseInLesson=function(e){return e==null&&(e=this.exercise),e===this.lessons[this.lesson-1].count},t.prototype.onEndOfCourse=function(e){return e==null&&(e=this.exercise),this.onLastExerciseInLesson&&this.lesson===this.lessons.length},t.prototype.curEditor=function(e,t){return e==null&&(e=this.lesson),t==null&&(t=this.exercise),this._editors[this.getiExercise(e,t)]},t.prototype.nextEditor=function(){var e;return e=this.iExercise+1<this._exerciseCnt?this.iExercise+1:this.iExercise,this._editors[e]},t.prototype.grade=function(e,t,n,i,o){return e?t.empty().append(s(n),r()):t.empty().append(f(n),u(),a(n,i,o)),t.parent().removeClass("hide")},t.prototype.evaluate=function(e,t,n,r,i,s){var o;return this.setCurrent(this.lesson,t),o=this.lessons[this.lesson-1].exercises[t],this.evalAndGrade(e,o,n,r,i,s)},t.prototype.evalAndGrade=function(e,t,n,r,i,s){var o,u,a,f,l;return u=r.find(".result-wrap"),o=r.find(".remark").filter(":hidden"),l=this._eval(e,t,n,i),f=l[0],a=l[1],e===void 0&&!i&&(e="undefined"),a?(this.grade(!0,u,e,i),o.length?o.slideDown(500,h.show,function(){return s.call(this,!0,r)}):s.call(this,!0,r)):(this.grade(!1,u,e,f,i),s.call(this,!1))},t.prototype._eval=function(e,t,n,r){var i,s;return s=!p(e),r?(n.context.eval(t.Solution),i=n.context.eval("ls_validate("+e+")"),[i,s&&i==="true"]):(i=n.context.eval(t.Solution),[i,s&&(e===i||p(i)&&t.AltSolution!=null&&c(e,t.AltSolution))])},t.prototype.scrollNext=function(t,n){var r;return n?r=t.offset().top+100:r=t.prev().offset().top-10,e("html,body").animate({scrollTop:r},h.speed,h.scrollNext)},t.prototype.saveScroll=function(e){return e==null&&(e=this.lesson),this._scrollY[e-1]=window.scrollY||window.pageYOffset},t.prototype.showLesson=function(e){var t;return e==null&&(e=this.lesson),this.focusExercise(),t=this.exercise===1?0:this._scrollY[e-1],setTimeout(function(){return window.scrollTo(0,t)},100)},t.prototype.focusExercise=function(t){var n;return e(".toc-exercises").eq(this.lesson-1).find(".exercise-link").removeClass("is-on"),t?(n=this.onLastExerciseInLesson(this.exercise)?this.exercise:this.exercise+1,e(".toc-exercises").eq(this.lesson-1).find(".exercise-link").eq(n-1).addClass("is-on"),this.nextEditor().focus()):(e(".toc-exercises").eq(this.lesson-1).find(".exercise-link").eq(this.exercise-1).addClass("is-on"),this.curEditor().focus())},t.prototype.onClick=function(t,n){var r,i;i=e(t).data("lesson"),r=e(t).data("exercise"),this.setCurrent(i,r),this.focusExercise();if(n==="run")return this.curEditor().getOption("onBlur")()},t.prototype.scrollTo=function(t){var n,r,i,s,o=this;return r=e(".lesson").eq(this.lesson-1),n=r.find(".exercise").eq(t-1).offset().top,s=r.find(".exercise").eq(this.exercise-1).offset().top-10,i=Math.abs(n-s)/2,e("html,body").animate({scrollTop:s},i,h.scrollTo,function(){return o.focusExercise()})},t.prototype.loadLesson=function(t,n){return e(".lesson").hide().eq(this.lesson-1).show(),e(".toc-lesson .lesson-link").removeClass("is-on").eq(this.lesson-1).addClass("is-on"),t?e(".toc-exercises").hide().eq(this.lesson-1).show():n!==this.lesson&&e(".toc-exercises").slideUp().eq(this.lesson-1).slideDown(),this.showLesson()},t.prototype.switchLesson=function(t){var n;return this.saveScroll(),n=this.lesson,this.setCurrent(e(t).data("next"),e(t).data("exercise")),this.loadLesson(!1,n)},t.prototype.loadExercise=function(t){var n,r,i,s;return s=this.lesson,i=this.exercise,r=e(t).data("next"),n=e(t).data("exercise"),s!==r?this.switchLesson(t):(this.setCurrent(r,n),this.scrollTo(i))},t.prototype.markCorrect=function(){var t;t=e(".toc-exercises").eq(this.lesson-1),t.find("li").eq(this.exercise-1).addClass("completed"),t.find(".eval-mark").eq(this.exercise-1).removeClass("hide");if(this.completedLesson())return e(".toc-lesson").eq(this.lesson-1).addClass("completed"),e(".toc-lesson .eval-mark").eq(this.lesson-1).removeClass("hide")},t.prototype.onCorrect=function(t,n){return this.keepScore(!0),this.markCorrect(),this.scrollNext(t,n),this.onLastExerciseInLesson()&&e(".next-lesson").eq(this.lesson-1).removeClass("hide"),this.setNextExercise(),this.focusExercise(!0)},t.prototype.showHint=function(t){var n,r,i,s,o;n=e(t),i=n.parent().next().find(".hint.hiddenState"),n.siblings(".hint-title").css("visibility","visible"),i.length&&i.first().slideToggle(200).removeClass("hiddenState"),s=i.length<=1,r=s?"No more hints":"Show more hints",n.text(r),s&&n.addClass("disabled");if(this.onLastExerciseInLesson(n.data("exercise")))return o=n.offset().top-10,e("html,body").animate({scrollTop:o},h.speed,h.scrollNext),this.saveScroll()},t}(),this.Course=l}).call(this);